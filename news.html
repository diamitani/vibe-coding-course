<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI News Feed | Vibe Coding Masterclass</title>
    <meta name="description" content="Stay up to date with the latest AI and vibe coding news from top tech sources.">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="ambient-bg"></div>
    <nav class="nav">
        <div class="nav-inner"><a href="index.html" class="nav-logo">âš¡ Vibe Coding</a><button class="nav-toggle"
                aria-label="Toggle navigation">â˜°</button>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="module1.html">Modules</a></li>
                <li><a href="tools.html">Tools</a></li>
                <li><a href="news.html">News</a></li>
                <li><a href="lab1.html">Labs</a></li>
                <li><a href="prompt-lab.html">Prompt Lab</a></li>
                <li><a href="community.html">Community</a></li>
                <li id="auth-nav-slot"></li>
            </ul>
        </div>
    </nav>

    <main class="page-content">
        <div class="container">
            <section class="hero" style="padding-bottom:var(--space-xl);">
                <span class="hero-badge"><span class="dot"></span> Live Feed</span>
                <h1>AI <span class="gradient-text">News</span></h1>
                <p>The latest in AI, vibe coding, and developer tools â€” curated from top sources across the web.</p>
            </section>

            <!-- Filters -->
            <div class="showcase-filters">
                <button class="filter-btn active" data-feed="all">All Sources</button>
                <button class="filter-btn" data-feed="theverge">The Verge</button>
                <button class="filter-btn" data-feed="techcrunch">TechCrunch</button>
                <button class="filter-btn" data-feed="ars">Ars Technica</button>
                <button class="filter-btn" data-feed="hackernews">Hacker News</button>
            </div>

            <div id="news-container">
                <div class="news-loading">
                    <div class="spinner"></div>
                    <p>Loading latest news...</p>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>âš¡ Vibe Coding Masterclass &copy; 2025</p>
        </div>
    </footer>
    <script src="script.js"></script>
    <script>
        const FEEDS = {
            theverge: { name: 'The Verge', url: 'https://www.theverge.com/rss/ai-artificial-intelligence/index.xml' },
            techcrunch: { name: 'TechCrunch', url: 'https://techcrunch.com/category/artificial-intelligence/feed/' },
            ars: { name: 'Ars Technica', url: 'https://feeds.arstechnica.com/arstechnica/technology-lab' },
            hackernews: { name: 'Hacker News', url: 'https://hnrss.org/newest?q=AI+coding+LLM&points=50' }
        };

        let allArticles = [];

        async function fetchFeed(key, feed) {
            try {
                // Try rss2json first (handles CORS + XML parsing reliably)
                const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feed.url)}`;
                const res = await fetch(apiUrl);
                const data = await res.json();

                if (data.status === 'ok') {
                    return data.items.slice(0, 8).map(item => {
                        const tmp = document.createElement('div');
                        tmp.innerHTML = item.description || item.content || '';
                        let cleanDesc = tmp.textContent.replace(/\s+/g, ' ').trim();
                        if (cleanDesc.length > 200) cleanDesc = cleanDesc.substring(0, 200) + '...';

                        return {
                            source: feed.name,
                            sourceKey: key,
                            title: (item.title || '').replace(/<!\[CDATA\[|\]\]>/g, '').trim(),
                            link: (item.link || '').trim(),
                            desc: cleanDesc,
                            date: item.pubDate ? new Date(item.pubDate.replace(/-/g, '/')) : new Date(),
                            dateStr: item.pubDate ? new Date(item.pubDate.replace(/-/g, '/')).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : 'Recent'
                        };
                    });
                }

                // Fallback to allorigins if rss2json fails
                const proxy = `https://api.allorigins.win/get?url=${encodeURIComponent(feed.url)}`;
                const fallbackRes = await fetch(proxy);
                const fallbackData = await fallbackRes.json();
                const parser = new DOMParser();
                const xml = parser.parseFromString(fallbackData.contents, 'text/xml');

                const items = xml.querySelectorAll('item, entry');
                const articles = [];
                items.forEach((item, i) => {
                    if (i >= 8) return;
                    const title = item.querySelector('title')?.textContent || '';
                    const link = item.querySelector('link')?.textContent || item.querySelector('link')?.getAttribute('href') || '';
                    const desc = item.querySelector('description, summary, content')?.textContent || '';
                    const pubDate = item.querySelector('pubDate, published, updated')?.textContent || '';

                    const tmp = document.createElement('div');
                    tmp.innerHTML = desc;
                    let cleanDesc = tmp.textContent.replace(/\s+/g, ' ').trim();
                    if (cleanDesc.length > 200) cleanDesc = cleanDesc.substring(0, 200) + '...';

                    articles.push({
                        source: feed.name,
                        sourceKey: key,
                        title: title.replace(/<!\[CDATA\[|\]\]>/g, '').trim(),
                        link: link.trim(),
                        desc: cleanDesc,
                        date: pubDate ? new Date(pubDate) : new Date(),
                        dateStr: pubDate ? new Date(pubDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : 'Recent'
                    });
                });
                return articles;
            } catch (e) {
                console.warn(`Failed to fetch ${feed.name}:`, e);
                return [];
            }
        }

        async function loadAllFeeds() {
            const promises = Object.entries(FEEDS).map(([key, feed]) => fetchFeed(key, feed));
            const results = await Promise.all(promises);
            allArticles = results.flat().sort((a, b) => b.date - a.date);
            renderNews('all');
        }

        function renderNews(filter) {
            const container = document.getElementById('news-container');
            const articles = filter === 'all' ? allArticles : allArticles.filter(a => a.sourceKey === filter);

            if (articles.length === 0) {
                container.innerHTML = `
          <div class="news-loading">
            <p style="font-size:2rem;margin-bottom:1rem;">ðŸ“¡</p>
            <p>No articles found. RSS feeds may be temporarily unavailable.</p>
            <p style="margin-top:1rem;"><button class="btn btn-secondary" onclick="loadAllFeeds()">Retry</button></p>
          </div>`;
                return;
            }

            container.innerHTML = `<div class="news-grid">${articles.map(a => `
        <a href="${escapeHTML(a.link)}" target="_blank" rel="noopener" class="news-card fade-in visible">
          <div class="news-source">${escapeHTML(a.source)}</div>
          <h3>${escapeHTML(a.title)}</h3>
          <div class="news-desc">${escapeHTML(a.desc)}</div>
          <div class="news-date">${a.dateStr}</div>
        </a>`).join('')}</div>`;
        }

        // Filter buttons
        document.querySelectorAll('.showcase-filters .filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.showcase-filters .filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderNews(btn.dataset.feed);
            });
        });

        // Load on page load
        loadAllFeeds();

        function escapeHTML(str) {
            if (!str) return '';
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        }
    </script>
</body>

</html>